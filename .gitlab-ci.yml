image: docker:latest

services:
  - name: docker:19.03.12-dind
    entrypoint: ["--host", "tcp://0.0.0.0:2375", "--host", "unix:///var/run/docker.sock"]

variables:
  DOCKER_HOST: "tcp://docker:2375"
  DOCKER_TLS_CERTDIR: "/certs"

stages:
  - build
  - deploy

before_script:
  - echo "Starting pipeline on $(hostname)"
  - docker info

build:
  stage: build
  script:
    - echo "üîß –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
    - docker-compose -f docker-compose.yml build

deploy:
  stage: deploy
  script:
    - echo "üöÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
    - docker-compose -f docker-compose.yml down
    - docker-compose -f docker-compose.yml up -d
