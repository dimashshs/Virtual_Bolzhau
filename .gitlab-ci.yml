image: docker:latest

services:
  - docker:dind

variables:
  DOCKER_TLS_CERTDIR: ""  # –æ—Ç–∫–ª—é—á–∞–µ–º TLS, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Docker

stages:
  - build
  - deploy

before_script:
  - echo "Starting pipeline on $(hostname)"
  - docker info

build:
  stage: build
  script:
    - echo "üîß –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
    - docker-compose -f docker-compose.yml build

deploy:
  stage: deploy
  script:
    - echo "üöÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
    - docker-compose -f docker-compose.yml down
    - docker-compose -f docker-compose.yml up -d
